var fm=new Object;var timestamp=new Date().getTime();fm.construct=function(){this.fstString=null;this.fstStringSelect=null;this.msg=null;this.begintime=0;this.showMsg=function(e,b,c){switch(b){case"red":b="red";break;default:b="#666666";break}this.msg.innerHTML='<span style="color: '+b+';">'+e+"</span>";if(!c){setTimeout("fm.showMsg('就绪！','',true);",4000)}}};var gt=new Object;gt.construct=function(){this.textbox=null;this.idButton=null;this.text="";this.arrText=[];this.o_fanjian=false;this.o_fanjianid=0;this.o_trim=true;this.o_linespace=1;this.o_banjiao=0;this.o_banjiaoArea=0;this.o_bolangxian=false;this.o_paragraphFirstString="　　";this.o_linefeedword="\n";this.o_delFakeLinefeed=false;this.o_biaodian=true;this.typeset_go=function(){this.boxlock();this.syncForm();this.initialize();this.splitText();this.baseType();this.mergeArray();this.sumup();this.textbox.value=this.text;this.boxready()};this.initialize=function(){this.begintime=new Date().getTime()};this.sumup=function(){this.cs2ct();this.bolangxian();this.biaodian()};this.clear=function(){this.textbox.value=""};this.syncForm=function(){this.text=this.textbox.value;if(this.text.trim()==""){alert("请填写文章内容！");this.boxready();return false}this.o_linespace=document.getElementById("linespaceSelect").value;this.o_trim=true;switch(document.getElementById("fstStringSelect").value){case"1":this.o_paragraphFirstString="";this.o_trim=false;break;case"2":this.o_paragraphFirstString="　　";break;case"3":this.o_paragraphFirstString="    ";break;case"4":this.o_paragraphFirstString="";break;default:this.o_paragraphFirstString=document.getElementById("fstString").value}if(!fast){this.o_fanjianid=document.getElementById("cs2ctSelect").value}this.o_fanjian=this.o_fanjianid=="0"?false:true;if(document.getElementById("quanjiao_no").checked){this.o_banjiao=0}else{if(document.getElementById("quanjiao_q").checked){this.o_banjiao=1}else{if(document.getElementById("quanjiao_b").checked){this.o_banjiao=2}}}this.o_bolangxian=document.getElementById("xx_blx").checked;this.o_biaodian=document.getElementById("xx_bd").checked};this.bolangxian=function(){if(false==this.o_bolangxian){return false}var temp=this.text;var i=0;temp=temp.replace(/～/g,"——");temp=temp.replace(/￣/g,"——");temp=temp.replace(/－/g,"——");temp=temp.replace(/｀/g,"——");temp=temp.replace(/~/g,"——");temp=temp.replace(/`/g,"——");temp=temp.replace(/··/g,"——");while(temp.indexOf("———")>0){temp=temp.replace(/———/g,"——");if(i++>99999999){break}}this.text=temp};this.pre_biaodian_bat=function(text,key,replace){last=0;var i=0;while(text.indexOf(key,last)>0){last=text.indexOf(key,last);d=text.indexOf(key,last)-1;wd=text.substr(d,1);if(wd.charCodeAt()>999){text=text.substr(0,d+1)+replace+text.substr(d+1+key.length)}last++;if(i++>99999){break}}return text};this.biaodian=function(){if(false==this.o_biaodian){return false}var temp=this.text;var i=0;temp=temp.replace(/．/g,".");temp=temp.replace(/\.\.\.\.\.\./g,"……");temp=temp.replace(/\.\.\./g,"…");temp=temp.replace(/…\.\./g,"……");temp=temp.replace(/…\./g,"…");temp=temp.replace(/\.\./g,"");temp=temp.replace(/。。/g,"……");temp=temp.replace(/…。/g,"…");temp=temp.replace(/\(/g,"（");temp=temp.replace(/\)/g,"）");while(temp.indexOf("………")>0){temp=temp.replace(/………/g,"……");if(i++>99999999){break}}temp=this.pre_biaodian_bat(temp,".","。");temp=this.pre_biaodian_bat(temp,",","，");i=0;while(temp.indexOf("，，")>0){temp=temp.replace(/，，/g,"，");if(i++>99999999){break}}temp=this.pre_biaodian_bat(temp,"?","？");temp=this.pre_biaodian_bat(temp,"!","！");temp=this.pre_biaodian_bat(temp,":","：");temp=this.pre_biaodian_bat(temp,"<<","《");temp=this.pre_biaodian_bat(temp,">>","》");this.text=temp};this.cs2ct=function(){switch(this.o_fanjianid){case"1":this.ts("zh2Hans");break;case"2":this.ts("zh2Hans");this.ts("zh2CN");break;case"3":this.ts("zh2Hans");this.ts("zh2SG");break;case"4":this.ts("zh2Hant");break;case"5":this.ts("zh2Hant");this.ts("zh2TW");break;case"6":this.ts("zh2Hant");this.ts("zh2HK");break;default:this.o_fanjian=false}};this.boxlock=function(){this.idButton.disabled=true;this.textbox.disabled=true;fm.showMsg("排版中，请稍候……","",true)};this.boxready=function(){this.idButton.disabled=false;this.textbox.disabled=false;fm.showMsg("排版完毕！耗时"+(new Date().getTime()-this.begintime+1)+"毫秒。","red")};this.splitText=function(){this.arrText=this.text.split(this.o_linefeedword)};this.baseType=function(){for(var i=0;i<this.arrText.length;i++){if(this.o_trim){this.arrText[i]=this.o_paragraphFirstString+this.arrText[i].trim()}this.arrText[i]=this.b2q(this.arrText[i])}};this.ts=function(w){if(this.o_fanjian==false){return 0}a=this.text;ba=0;if(w=="zh2Hant"){ba="10447"}if(w=="zh2Hans"){ba="6815"}if(w=="zh2TW"){ba="914"}if(w=="zh2HK"){ba="2991"}if(w=="zh2CN"){ba="615"}if(w=="zh2SG"){ba="372"}for(na=0;na<ba;na++){a=a.replace(window.eval("/"+window.eval(w).words[window.eval(na)].t+"/g"),window.eval(w).words[window.eval(na)].c)}this.text=a};this.b2q=function(a){if(this.o_banjiao==0){return a}var w="b2q",wba="95";var w2="q2b",w2ba="94";if(this.o_banjiao==1){for(na=0;na<w2ba;na++){a=a.replace(window.eval("/"+window.eval(w2).words[window.eval(na)].b+"/g"),window.eval(w2).words[window.eval(na)].q)}}else{for(na=0;na<wba;na++){a=a.replace(window.eval("/"+window.eval(w).words[window.eval(na)].q+"/g"),window.eval(w).words[window.eval(na)].b)}}return a};this.mergeArray=function(){if(this.o_linespace>0){this.text="";var thislinefeed="";for(var i=0;i<this.o_linespace;i++){thislinefeed+=this.o_linefeedword+""}for(var i=0;i<this.arrText.length;i++){if(this.arrText[i].trim()==""){continue}this.text+=this.text==""?this.arrText[i]:thislinefeed+this.arrText[i]}}else{this.text=this.arrText.join(this.o_linefeedword)}};this.teststring=function(){this.textbox.value=""};this.teststringForBiaodian=function(){this.textbox.value=""};this.loadOption=function(){this.minceOption_0("xx_bd","option0");this.minceOption_0("xx_blx","option1",true);this.minceOption_0("selectall","option2",true);this.minceOption_1("linespaceSelect","option3","2");this.minceOption_1("fstStringSelect","option4","2");if(!fast){this.minceOption_1("cs2ctSelect","option5","0")}this.id("fstString").value=this.getcookie("option6")==null?"　　":this.getcookie("option6")};this.minceOption_0=function(id,coname,defaultvalue){var defaultvalue=arguments[2]||false;this.id(id).checked=this.getcookie(coname)==null?defaultvalue:this.getcookie(coname)=="true"};this.minceOption_1=function(id,coname,defaultvalue){this.id(id).value=this.getcookie(coname)==null?defaultvalue:this.getcookie(coname)};this.saveOption=function(){this.setcookie("option0",this.id("xx_bd").checked,999999999);this.setcookie("option1",this.id("xx_blx").checked,999999999);this.setcookie("option2",this.id("selectall").checked,999999999);this.setcookie("option3",this.id("linespaceSelect").value,999999999);this.setcookie("option4",this.id("fstStringSelect").value,999999999);if(!fast){this.setcookie("option5",this.id("cs2ctSelect").value,999999999)}this.setcookie("option6",this.id("fstString").value,999999999)};this.setcookie=function(sName,sValue,iTime){var date=new Date();date.setTime(date.getTime()+iTime*1000);document.cookie=escape(sName)+"="+escape(sValue)+"; expires="+date.toGMTString()};this.getcookie=function(name){var arg=name+"=";var alen=arg.length;var clen=document.cookie.length;var i=0;while(i<clen){var j=i+alen;if(document.cookie.substring(i,j)==arg){return this.GetCookieVal(j)}i=document.cookie.indexOf(" ",i)+1;if(i==0){break}}return null};this.GetCookieVal=function(offset){var endstr=document.cookie.indexOf(";",offset);if(endstr==-1){endstr=document.cookie.length}return unescape(document.cookie.substring(offset,endstr))};this.id=function(a){return document.getElementById(a)}};String.prototype.trim=function(){return this.replace(/^( |[\s　])+|( |[\s　])+$/g,"")};gt.construct();fm.construct();window.onload=function(){resize();gt.textbox=document.getElementById("textbox");gt.idButton=document.getElementById("button");fm.msg=document.getElementById("msg");fm.fstString=document.getElementById("fstString");fm.fstString=document.getElementById("fstStringSelect");fm.showMsg("就绪！","",true);document.getElementById("gtform").style.display="";resize();gt.loadOption();showfstStringSpan();setInterval("gt.saveOption()",3000)};